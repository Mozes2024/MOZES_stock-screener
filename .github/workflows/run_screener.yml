name: Run Stock Screener Daily

# 1. מתי להפעיל את הפעולה
on:
  # הפעלה אוטומטית: כל יום בשעה 16:00 שעון ישראל (13:00 UTC)
  schedule:
    - cron: '0 13 * * *'
  # מאפשר הפעלה ידנית דרך כפתור
  workflow_dispatch:

# הגדרת המשימות
jobs:
  run-screener:
    # 2. השרת שעליו ירוץ הקוד
    runs-on: ubuntu-latest
    
    # שלבי הביצוע
    steps:
    
    # שלב א': שכפול הקוד
    - name: Checkout repository code
      uses: actions/checkout@v4
      
    # שלב ב': הגדרת סביבת פייתון
    - name: Set up Python 3.12 
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        
    # שלב ג': התקנת התלויות
    - name: Install dependencies
      run: pip install -r requirements.txt

    # שלב ד': הרצת הסקריפט עם המסננים שלך!
    - name: Execute Screener with Custom Filters
      run: |
        python run_optimized_scan.py \
          --min-price 10.0 \
          --min-volume 500000 \
          --workers 3 \
          --delay 0.5

    # שלב ה': שמירת הקובץ כ-Artifact
    - name: Upload Scan Report as Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Stock_Screener_Report
        path: ./data/daily_scans/latest_optimized_scan.txt
        retention-days: 90
