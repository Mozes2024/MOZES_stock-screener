name: Run Stock Screener Daily

# 1. 转 驻注 转 驻注
on:
  # 驻注 转:   砖注 16:00 砖注 砖专 (13:00 UTC)
  schedule:
    - cron: '0 13 * * *'
  # 驻砖专 驻注 转 专 驻转专
  workflow_dispatch:

# 专转 砖转
jobs:
  run-screener:
    # 2. 砖专转 砖注 专抓 拽
    runs-on: ubuntu-latest
    
    # 专转 专砖转 -  注专 砖专转 Cache
    permissions:
      contents: write
      
    # 砖 爪注
    steps:
    
    # 砖 ': 砖驻 拽
    - name: Checkout repository code
      uses: actions/checkout@v4
      
    #  砖 ': 住专  注 专 拽专 (UPSTREAM) - (转拽)
    - name: Auto-Sync with Upstream Repository
      uses: dabreadman/sync-action@v1.0.0 # Action 转拽
      with:
        target_repo: 'RyanJHamby/stock-screener'
        target_branch: 'main'
        github_token: ${{ secrets.GITHUB_TOKEN }}
        
    # 砖 ': 专转 住转 驻转
    - name: Set up Python 3.12 
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        
    # 砖 ': 转拽转 转转
    - name: Install dependencies
      run: pip install -r requirements.txt

    # 砖 ': 专爪转 住拽专驻 注 住 砖!
    - name: Execute Screener with Custom Filters
      run: |
        python run_optimized_scan.py \
          --min-price 10.0 \
          --min-volume 500000 \
          --workers 3 \
          --delay 0.5

    # 砖 ': 砖专转 拽抓 -Artifact
    - name: Upload Scan Report as Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Stock_Screener_Report
        path: ./data/daily_scans/latest_optimized_scan.txt
        retention-days: 90
        
    #  砖 ': 砖专转 拽爪 -Cache 转 专 (Commit to Data)
    - name: Save Fundamentals and Price Cache to Repository
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "chore: update fundamental and price cache files"
        branch: main
        commit_options: '--no-verify --allow-empty'
        file_pattern: data/**
